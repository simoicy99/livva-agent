// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  clerk_user_id String   @unique
  email         String?
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  search_sessions SearchSession[]
  saved_listings  SavedListing[]
  preferences     UserPreferences?

  @@map("users")
  @@index([clerk_user_id])
}

model Listing {
  id          String   @id @default(cuid())
  platform    String
  photo       String
  price       Float
  location    String
  match_score Int      @default(0)
  why_it_fits String
  metadata    Json?    // Flexible JSON for additional data
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  saved_by SavedListing[]

  @@map("listings")
  @@index([platform])
  @@index([price])
  @@index([match_score])
}

model SearchSession {
  id         String   @id @default(cuid())
  user_id    String
  filters    Json     // Store SearchFilters as JSON
  results    Json?    // Store search results as JSON array
  metadata   Json?    // Additional flexible data
  created_at DateTime @default(now())

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("search_sessions")
  @@index([user_id])
  @@index([created_at])
}

model SavedListing {
  id         String   @id @default(cuid())
  user_id    String
  listing_id String
  notes      String?
  metadata   Json?    // Flexible JSON for tags, reminders, etc.
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  listing Listing @relation(fields: [listing_id], references: [id], onDelete: Cascade)

  @@unique([user_id, listing_id])
  @@map("saved_listings")
  @@index([user_id])
  @@index([listing_id])
}

model UserPreferences {
  id          String   @id @default(cuid())
  user_id     String   @unique
  preferences Json     // Flexible JSON for user preferences
  metadata    Json?    // Additional flexible data
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("user_preferences")
  @@index([user_id])
}
